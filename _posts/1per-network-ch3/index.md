---
title: "[성공과 실패를 결정하는 1%의 네트워크 원리] 3장"
date: 2021-10-01  
tags:
- network
- book
- 1per-network
---

'성공과 실패를 결정하는 1%의 네트워크 원리' 스터디를 진행하며 정리한 내용이다.

---

## 01 케이블과 리피터, 허브 속을 신호가 흘러간다

1. 하나하나의 패킷이 독립된 것으로 동작한다.
    - 중계 동작은 패킷의 헤더에 기록된 제어 정보와 중계 장치의 내부에 있는 중계 대상을 등록한 표로 목적지를 판단하고 목적지에 가까워지도록 하여 패킷을 중계한다는 형태
        - 내용은 보질 않기에 애플리케이션 데이터나 TCP 프로토콜의 제어 정보의 내용은 패킷을 운반하는 동작에 영향을 주지 않는다.
        - 따라서 모든 패킷은 아무 관련도 없는 별개의 것으로 간주하고 목적지를 향해 중계된다.

2. LAN 케이블은 신호를 약화시키지 않는 것이 핵심이다.
    - 이더넷 신호의 실체는 플러스와 마이너스의 전압이므로 LAN 어댑처의 PHY(MAU) 회로의 플러스와 마이너스 신호 단자에서 신호가 나온다고 생각.
    - 신호는 케이블 속을 흘러 리피터 허브의 커넥터 부분에 도착하고, 이 부분은 단순히 전기 신호카 케이블을 통해 전달되는 것뿐.
    - 케이블을 통과하는 사이에 신호의 에너지가 조금씩 떨어지므로 케이블의 길이가 길어질수록 신호가 약해짐.

3. '꼼'은 잡음을 방지하기 위한 방법이다.
    - LAN 케이블로 사용하는 트위스트 페어 케이블(꼰 선쌍)에는 이러한 잡음의 영향을 억제하는 대책이 마련되어 있는데, 이것이 '꼼'이다.
        - 신호선을 마주 꼬아서 잡음을 막을 수 있다.

4. 리피터 허브는 연결되어 있는 전체 케이블에 신호를 송신한다.
    - 신호가 리피터 허브에 도달하면 LAN 전체에 신호가 흩어진다.
    - 리피터 허브에서 PHY(MAU) 회로의 수신부에 도달한 신호는 여기부터 리피터 회로에 들어간다. 리피터 회로의 기본은 들어오는 신호를 리피터 허브의 커넥터 부분에 뿌리는 데 있다.
    - 리피터 회로의 기본은 신호를 그대로 뿌리는 것이므로 잡음의 영향을 받아 변형되고, 데이터가 변화한 것 같은 신호라도 그대로 흘려버린다.
        - 다음 기기에 도달하여 디지털 데이터로 변환되고, FCS를 검사하는 곳에서 데이터 변화가 판명된 후 변화된 패킷은 폐기한다.
          패킷을 폐기하면 수신 확인 응답을 되돌려주지 않으므로 프로토콜 스택의 TCP 담당 부분이 패킷을 다시 보낸다.

<br/>

## 02 스위칭 허브의 패킷 중계 동작

1. 스위칭 허브는 주소 테이블로 중계한다
    - 스위칭 허브는 이더넷의 패킷을 그대로 목적지를 향해 중계하도록 만들어져 있다.
    - 신호가 커넥터 부분에 도달하여 PHY(MAU) 회로에서 수신되는 부분까지는 리피터 허브와 같다.
    - PHY(MAU) 회로에서 케이블을 흐르는 신호의 형식부터 공통의 신호 형식으로 변환한 후 신호는 MAC 회로에 들어간다.
    - 디지털 데이터로 변환한 후 패킷의 맨 끝에 있는 FCS를 대조하여 오류의 유무를 검사하고, 문제가 없으면 버퍼 메모리에 저장한다.
    - 커넥터와 안쪽에 있는 회로 부분은 포트라고 부르므로 스위칭 허브의 각 포트는 PC의 LAN 어댑터와 거의 같다.
        - LAN 어댑터는 MAC 주소가 할당되어 있어 수신한 패킷의 수신처 MAC 주소가 자신에게 해당하지 않는 경우에는 패킷을 폐기한다.
          반면, 스위칭 허브의 포트는 수신처 MAC 주소를 검사하지 않고 모든 패킷을 버퍼 메모리에 저장하기 때문에 MAC 주소가 할당되어 있지 않다.
    - MAC 주소표를 이용해 MAC 주소가 일치하는지 확인하고 일치하면 스위치 회로를 경유하여 패킷을 송신측 포트에 보낸다.
        - 스위치 회로는 전자 회로로 만든 것으로 스위치의 전자적 개폐를 통해 신호가 흐르는 대상을 제어한다.
    - 송신측의 포트에 패킷을 운반하면 MAC 회로나 PHY(MAU) 회로가 송신 동작을 실행하고 케이블에 신호가 흘러간다.
        - 누군가가 송신 중이면 송신 동작이 끝나거나 아무도 송신하지 않으면 소켓을 디지털 데이터에서 신호로 변환하여 송신함.
        - 송신 동작 중에 다른 기기가 보낸 신호가 수신측에 들어오면 패킷을 충돌하므로 재밍 신호를 보낸 후 송신 동작을 중지하고 잠시 기다렸다 다시 보냄.

2. MAC 주소 테이블을 등록 및 갱신한다.
    - 스위칭 허브는 패킷을 중계할 때 MAC 주소표의 내용을 갱신하는 동작도 실행한다.
    - 갱신 동작은 두 종류가 있다.
        1. 패킷을 수신했을 때 송신처 MAC 주소를 조사하고, 이것을 수신한 입력 포트 번호와 하나의 세트로 MAC 주소표에 등록한다.
        2. MAC 주소표에 등록되어 있는 내용을 지운다.
            - MAC 주소표에 등록한 정보는 그대로 두는 것이 아니라 사용하지 않고 일정 시간이 경과하면 삭제하는 것.
    - MAC 주소표의 내용은 스위칭 허브 자체가 스스로 등록하거나 삭제하므로 수동으로 등록 및 삭제할 필요가 없다.

3. 예외적인 동작
    - 스위칭 허브는 패킷을 수신한 포트와 송신하는 포트가 같을 경우 패킷을 중계하지 않고 폐기함.
    - MAC 주소표에 수신처 MAC 주소와 일치하는 주소가 등록되어 있지 않은 경우 어느 포트에 송신해야 할지 판단할 수 없으므로 패킷을 수신한 포트 이외의 전체 포트에게 패킷을 송신한다.
        - 수신처 MAC 주소가 브로드캐스트 주소인 경우에도 수신 포트를 제외하고 모든 포트에서 패킷을 송신함.

4. 전이중 모드에서 송신과 수신을 동시에 실행한다.
    - 전이중 모드, 즉 송신과 수신을 동시에 실행할 수 있는 성질도 리피터 허브에는 없는 스위칭 허브의 특징이다.

5. 최적의 전송 속도로 보내는 자동 조정
    - 전이중 모드가 등장한 후 접속한 상대가 전이중 모드를 지원하는지 검출하고 동작 모드를 자동으로 전환하는 기능이 나왔다.
    - 동작 모드뿐만 아니라 상대의 전송 속도를 검출하여 전송 속도도 자동으로 전환하는데, 이 기능을 자동 조정이라고 함.

6. 스위칭 허브는 복수의 중계 동작을 동시에 실행한다.
    - 스위칭 허브는 수신처 MAC 주소의 기기가 존재하는 포트 이외에는 송신 동작을 실행하지 않으므로 다른 포트는 빈 상태가 된다.
        - 비어있으므로 여기에서 별도의 패킷을 흘릴 수 있으며, 이렇게 해서 동시에 여러 개의 패킷을 중계할 수 있다.
    - 리피터 허브는 들어온 신호를 모든 포트에서 뿌리므로 동시에 두 개 이상의 신호가 들어오면 패킷이 충돌하기 때문에 복수의 신호를 동시에 흘릴 수 없다.
        - 기기 전체에서 중계할 수 있는 패킷의 수는 스위칭 허브쪽이 리피터 허브쪽보다 많다.


<br/>

## 03 라우터의 패킷 중계 동작

1. 라우터의 기본
    - 리피터 허브나 스위칭 허브를 경유한 패킷은 결국 라우터에 도착하고, 라우터에서 다음 라우터로 중계될 것이다.
    - 라우터의 내부 구조는 중계 부분과 포트 부분으로 구성되어 있다.
        - 중계 부분 - 패킷이 중계 대상을 판단하는 동작을 담당함. IP 담당 부분이라고 생각.
        - 포트 부분 - 패킷을 송, 수신하는 동작을 담당함. LAN 어댑터라고 생각.
          통신 기술의 하드 웨어를 장착하면 다양한 통신 기술을 지원할 수 있음.
        - 포트 부분에서 패킷을 수신하는데, 이 동작은 포트 부분의 통신 기술 규칙을 따름. 포트 부분이 이더넷이라면 이더넷의 규칙을, 무선 LAN이라면 무선 LAN의 규칙을, 통신 회선이면 통신 회선의 규칙을 따름.
          중계 부분에서 받은 패킷의 IP 패킷에 기록되어 있는 수신처 IP 주소와 중계 대상을 등록한 표를 대조하여 중계 대상을 판단함.
        - 포트 부분이 패킷의 송신처 또는 수신처가 되어 패킷을 송, 수신함.
          예를 들어 포트가 이더넷인 경우 라우터의 포트에는 MAC 주소가 할당되어 이더넷의 송신처, 수신처가 됨. 포트에는 IP 주소도 할당됨.
          스위칭 허브는 돌아온 패킷을 전송만 할뿐 자신이 송신처나 수신처가 되지는 않음.

2. 경로표에 등록된 정보

   스위칭 허브는 MAC 헤더에 기록되어 있는 수신처 MAC 주소로 중계 대상을 판단하지만, 라우터는 IP 헤더에 기재되어 있는 수신처 IP 주소로 중계 대상을 판단함.

    - 라우터의 테이블은 라우팅 테이블 또는 경로표라고 부른다.
        - 맨 왼쪽에는 수신처의 정보가 들어있는 수신처 항목이 있다.
            - 수신처의 정보는 서브넷 자체를 나타내는 주소, 즉 네트워크 번호 부분의 비트에만 값이 있고, 호스트 번호 부분의 비트 값은 0으로 되어 있는 IP 주소가 들어있다고 생각하자.
            - 네트워크 번호의 부분만 조사함.
        - 주소 비교 동작을 실행할 때 네트워크 번호의 비트 수를 판단하기 위해 넷마스크 항목도 있음.
        - '수신처' 항목에는 서브넷을 나타내는 IP 주소가 등록되었다고 했지만, 그렇지 않은 경우도 있음.
          실제 서브넷에 할당된 넷마스크의 값과 경로표에 등록된 넷마스크 값이 다를 수 있음.
            - 주소 집약이라는 개념을 이용하면 몇 개의 서브넷을 모아서 한 개의 서브넷으로 간주한 후 묶은 서브넷을 경로표에 등록할 수 있음.
                - 10.10.1.0/24, 10.10.2.0/24, 10.10.3.0/24 3개의 서브넷이 라우터 A와 연결되는 상태에서 라우터 B가 이 서브넷에 패킷을 건네주려고 할 때 라우터 B의 경로표에 3개의 서브넷을 별도로 등록하는 것이 원칙.
                  하지만 다 라우터 A에 패킷을 중계하는 것은 바뀌지 않으므로 통합한 10.10.0.0/16이라는 서브넷이 있는 것으로 간주.
            - 한 개의 서브넷을 세분화하여 경로표에 등록하고, 복수의 서브넷이 있는 것처럼 보이는 경우도 있음.
            - '수신처' 항목에 등록된 네트워크 번호가 실제와 다르더라도 라우터는 제대로 동작하므로 걱정할 필요는 없다.
            - 호스트 번호 부분에 값이 들어있는 개별 컴퓨터를 나타내는 주소를 '수신처'에 등록도 가능. → 넷마스크 값을 255.255.255.255 즉, 32 비트를 전부 1로 만들면 됨.
        - '게이트웨이' 항목과 '인터페이스' 항목은 패킷의 중계 대상을 나타냄.
            - '인터페이스' 항목에 등록되어 있는 인터페이스(포트)에서 '게이트웨이' 항목에 등록되어 있는 IP 주소를 가진 라우터에 대해 패킷을 중계함
        - 메트릭은 수신처 IP 주소에 기록되어 있는 목적지가 가까운지, 먼지를 나타냄.
            - 수가 작으면 목적지가 가까이에 있고, 이 수가 크면 먼 것을 나타냄.
        - 라우터가 경로표에 경로 정보를 등록하거나 갱신하는 동작은 패킷을 중계하는 동작과 분리되어 있음. 즉, 패킷을 중계할 때 경로표의 내용에 손대지 않음.

          경로 정보 등록 방법

            1. 사람이 수동으로 경로 정보를 등록/갱신
            2. 라우터 프로토콜이라는 구조를 사용하여 라우터들끼리 경로 정보를 교환하고 라우터가 자체에게 경로표에 등록 (RIP, OSPF, BGP 등등)

3. 라우터의 패킷 수신 동작
    - 이더넷의 포트에서의 패킷 수신 동작에 초점을 맞추어서 설명
        - LAN 어댑터와 거의 같다
    - 신호가 커넥터 부분에 도착하면 PHY(MAU) 회로, MAC 회로에서 신호를 디지털 데이터로 변환함.
    - 패킷 끝부분의 FCS를 대조하여 오류의 유무를 점검하고, 정상이면 MAC 헤더의 수신처 MAC 주소가 자신에게 해당하는지 조사하여 해당하면 패킷을 수신 버퍼 메모리에 저장함.
        - 수신처 MAC 주소에 자신이 해당하지 않을 경우에는 패킷을 폐기함.

4. 경로표를 검색하여 출력 포트를 발견한다.
    - 라우터 패킷 수신 동작이 끝나면 맨 앞의 MAC 헤더를 폐기함. MAC 헤더의 수신처 MAC 주소 항목에 라우터의 포트에 할당한 MAC 주소가 기록되어 있음.
    - IP 헤더의 내용을 보고 패킷 중계 동작에 들어감.

        ![Untitled - 2021-12-22T173052 198](https://user-images.githubusercontent.com/62014888/147061439-732256e7-aaca-44ca-8a54-9d79eadc1f2b.png)

        - 중계 대상을 조사할 때 가장 먼저 수신한 패킷의 수신처 IP 주소와 경로표의 '수신처' 항목을 조사하여 해당하는 행을 찾음.
            - '넷마스크' 항목에 등록된 값에서 네트워크 번호의 비트 수를 판단하여 네트워크 번호 부분만 비교함.
                - 복수의 후보가 발견되면 네트워크 번호의 비트 수가 가장 긴 것을 찾는다.
                - 네트워크 번호의 비트 수가 길면 호스트 번호의 비트 수가 짧아지는데 이 뜻은 호스트 번호로 할당 가능한 번호의 수가 적다는 뜻.
                - 이는 서브넷에 접속 가능한 대수가 적다는 뜻이므로 서브넷이 작다는 것과 같은 의미이며, 그만큼 범위가 축소됨.
            - 네트워크 번호의 길이가 같다면 가깝다는 뜻으로 메트릭 값이 작은 쪽을 중계 대상으로 선택함.
        - 행이 한 개도 발견되지 않으면 패킷을 폐기하고 ICMP 메시지로 송신처에 이 사실을 통지한다.
            - 라우터는 규모가 크기에 중계 대상을 모르는 패킷을 뿌린다면 대량의 패킷이 뿌려져 네트워크가 혼잡해짐.

5. 해당하는 경로가 없는 경우에 선택하는 기본 경로
    - '넷마스크' 항목이 0.0.0.0이라는 것은 패킷의 수신처 IP 주소와 경로표의 '수신처' 항목을 비교할 때의 비트 수가 0이라는 것이므로 비교 동작을 실행하지 않아도 됨.
    - 이 행의 '게이트웨이' 항목에 인터넷으로 나가는 라우터를 등록해 두면 다른 행에 해당하는 것이 없는 경우에는 패킷을 그곳으로 중계함.
        - 이 행을 기본 경로라고 하며, 여기에 등록한 라우터를 기본 게이트웨이라고 함.

6. 패킷은 유효 기간이 있다.
    - 중계 대상을 찾아내면 패킷을 출력측의 포트로 옮기고 여기에서 송신하는데, 그 전에 몇 가지 할 일이 있다.
    - TTL(Time To Live, 생존 기간)이라는 IP 헤더의 필드를 갱신하는 것이다.
        - 라우터를 경유할 때마다 이 값을 1씩 줄이다가 숫자가 0이 되면 패킷을 폐기함.
        - 송신처가 처음 패킷을 송신할 때 64 또는 128이라는 값을 설정함.
        - 인터넷은 지구의 반대편까지 액세스해도 경유하는 라우터 수가 많아야 수십개 정도.

7. 큰 패킷은 조각 나누기 기능으로 분할한다
    - 라우터 포트 부분은 이더넷뿐만 아니라 이더넷 이외의 LAN이나 통신 회선의 경우도 있다.
        - 회선이나 LAN 종류에 따라 패킷의 최대 길이가 달라지므로 출력 포트측의 패킷의 최대 길이가 입력측보다 작은 경우도 있다.
        - 어느 경우든지 중계하는 패킷의 크기가 출력측의 패킷 최대 길이를 초과하면 그대로는 패킷을 송신할 수 없다.
    - IP 프로토콜에서 규정된 조각 나누기(fragmentation)라는 방법을 사용하여 패킷을 분할하고, 패킷의 길이를 짧게 만든 후 중계한다.
        - TCP가 데이터를 조각으로 분할하는 것과 다름.
        - TCP 데이터 분할은 패킷에 데이터를 저장하기 전에 이루어지고 조각 나누기쪽은 패킷이 만들어진 후에 패킷을 분할하는 것.
    - 출력측의 MTU를 조사하여 중계하는 패킷을 그대로 출력측에서 송신할 수 있는지 조사한다.
        - MTU가 충분히 커서 분할하지 않아도 송신할 수 있으면 분할하지 않음.
        - MTU가 작은 경우에는 여기에 저장할 수 있는 크기로 패킷을 분할하는데, 그 전에 IP 헤더의 플래그 필드를 조사하여 분할해도 좋을지 확인함.
    - 플래그 필드가 분할 불가로 되어 있으면 분할할 수 없으므로 패킷을 폐기하고 ICMP 메시지로 송신처에 통지한다.
    - 그렇지 않으면 출력측 MTU에 맞춰 데이터 부분을 맨 앞부분부터 차례대로 잘라낸다.
        - TCP 헤더 이후의 부분을 분할 대상 데이터로 간주한다.
        - 데이터를 분할하면 IP 헤더를 덧붙이는데 내용은 원래 패킷 IP 헤더를 그대로 복사한 것이라고 생각하면 된다. 단, 일부 필드는 고쳐쓰는데 분할한 핵심 정보를 IP 헤더에 기록하기 위해서이다.

8. 라우터의 송신 동작은 컴퓨터와 같다.
    - 송신 동작은 출력측의 포트에 따라 다르다.
        - 이더넷이라면 이더넷의 규칙에 따라 패킷을 신호로 변환하여 송신하고, ADSL이라면 ADSL의 규칙에 따라 송신한다는 식.
    - 출력측의 포트가 이더넷인 경우의 송신 동작
        - MAC 헤더의 맨 앞에 있는 수신처 MAC 주소 필드에 값을 설정하기 위해 경로표의 '게이트웨이' 항목에서 패킷을 건네줄 상대를 판단한다.
            - '게이트웨이' 항목에 IP 주소가 쓰여있으면 이 IP 주소로, 비어있으면 IP 헤더의 수신처 IP 주소가 건네줄 상대가 된다.
            - ARP로 IP 주소에서 MAC 주소를 조사하고 결과를 MAC 주소로 설정.
              먼저 ARP 캐시를 찾아보고 없으면 ARP로 조회함.
        - 송신처 MAC 주소 필드는 출력측의 포트에 할당된 MAC 주소를 설정함. 타입 필드에 0800(16진수)을 설정함.
        - 송신 패킷을 전기 신호로 변환하여 포트에서 송신함.
            - 반이중 모드라면 케이블에 신호가 흐르지 않는 것을 확인 후 신호를 송출, 충돌할 경우 잠시 기다린 다음에 다시 보냄.
            - 전이중 모드라면 케이블 신호를 확인하지 않고 그대로 신호를 송신.
        - 출력측 포트가 이더넷이라면 패킷은 스위칭 허브를 경유하여 다음 라우터에 도달함.
        - 라우터가 그 다음 라우터에 패킷을 중계.
        - 반복하고 최종적으로 목적지에 도착함.

9. 라우터와 스위칭 허브의 관계
    - 이때까지 MAC 헤더를 부가한다고 표현했지만 이더넷의 패킷 데이터 부분에 IP의 패킷을 넣는다고 표현하는 것이 원래의 개념에 가깝다.
        - 즉, MAC 헤더를 부가하여 패킷을 송신한다는 것은 이더넷의 패킷 데이터 부분에 IP의 패킷을 넣고 이더넷의 원리로 다음 라우터까지 운반한다는 것.
    - IP라는 구조는 스스로 패킷을 운반하는 수단이 없으므로 패킷을 운반할 때에 이더넷에 의뢰하여 운반한다.
    - 즉 라우터는 패킷을 운반하는 일을 스위칭 허브에 의뢰한다.
        - 실제 라우터는 스위칭 허브를 내장한 기종이 있다보니 설명이 적당하지 않은 경우도 있지만 '순수한' 라우터라는 것에 집중하자.
    - 통신 상대까지 패킷을 전달하는 전체의 동작은 IP(라우터)가 당담하고, 이 동작을 할 때 다음 라우터까지 패킷을 운반하는 부분은 이더넷(스위칭 허브)이 담당한다.
    - 이더넷이 아닌 다른 다양한 통신 기술을 사용해도 마찬가지다. 요컨대 이 통신 기술에 의뢰하여 패킷을 운반하는 것.
      다양한 통신 기술을 적재적소에 구분하여 사용할 수 있다는 특징 덕분에 인터넷이라는 거대한 네트워크가 만들어진 것.


<br/>

## 04 라우터의 부가 기능

1. 주소 변환으로 IP 주소를 효율적으로 이용한다.
    - 인터넷이 일반에게 공개되자 급속하게 접속 대수가 늘어나기 시작하면서 고유한 주소가 고갈될 것이라는 예측이 나왔음.
    - 이 문제를 해결하기 위하여 사내의 기기에 할당하는 주소는 다른 회사와 중복되어도 좋다고 하기로 함.
    - 특정 주소를 사내용으로 사용한다는 규칙을 세웠고 이 규칙에 기초한 사내용 주소는 프라이비트 주소(private address), 이전의 고유한 주소는 글로벌 주소(global address)라고 부름.
        - 프라이비트 주소 규칙은 아래의 범위로 한정한다는 것뿐
          10.0.0.0 ~ 10.255.255.255
          172.16.0.0 ~ 172.31.255.255
          192.168.0.0 ~ 192.168.255.255

    - 사내 네트워크는 완전히 독립되어 있는 것이 아니라 인터넷을 통해 많은 회사에 연결되므로 패킷이 사내와 인터넷을 왕래하면 여기저기에 같은 주소가 있게 되어 패킷을 정확히 운반할 수 없게 됨.

        ![Untitled - 2021-12-22T173056 321](https://user-images.githubusercontent.com/62014888/147061441-59628a54-e5ec-479c-b5d5-ba3f1450ca7c.png)

    - 위와 같이 구성해서 사내의 네트워크를 인터넷에 공개하는 서버를 접속하는 부분과 사내용 네트워크의 두 가지로 나눴음.
    - 사내 네트워크에는 인터넷과 직접 패킷을 주고받지 않도록 특별한 구조를 사용하여 접속하는데, 이 구조가 주소 변환이다.

2. 주소 변환의 기본 동작
    - 주소 변환의 구조는 패킷을 중계할 때 IP 헤더에 기재된 IP 주소와 포트 번호를 바꿔쓰는 것이다.

        ![Untitled - 2021-12-22T173059 190](https://user-images.githubusercontent.com/62014888/147061451-6b753eb5-940e-44c0-932d-b436679190fd.png)

    - TCP 접속 동작에서 최초로 흐르는 패킷을 인터넷에 중계할 때 송신처의 IP 주소를 프라이비트 주소에서 글로벌 주소로 바꿔쓴다.
        - 글로벌 주소는 주소 변환 장치의 인터넷측에 있는 포트에 할당된 주소로, 이것과 동시에 포트 번호도 바꾸어 씀.
        - 포트 번호쪽은 미사용 번호로 주소 변환 장치가 적당히 선택하여 사용함.
    - 바꿔쓰기 전의 프라이비트 주소와 포트 번호, 바꿔쓴 후의 글로벌 주소와 포트 번호를 한 세트로 하여 주소 변환 장치 내부에 있는 대응표에 기록해둠.
    - 인터넷에 송출하고 패킷은 서버에 도착하며 여기에서 회신 패킷이 돌아온다. 이 때 회신 패킷의 수신처는 바꿔쓴 글로벌 주소와 포트 번호로 되어 있을 것이다. 이 글로벌 주소는 주소 변환 장치에 할당되어 있으므로 회신 패킷은 주소 변환 장치에 되돌아온다.
    - 주소 변환 장치는 주소 대응표를 통해 프라이비트 주소와 포트 번호로 바꾸고 사내 네트워크에 패킷을 보낸다.
    - 데이터 송, 수신이 끝나고 연결 끊기 동작의 패킷이 흐르다 인터넷에 대한 접속 동작이 끝나면 대응표에 등록한 것을 삭제한다.
    - 인터넷에서 보면 주소 변환 장치가 통신 상대로 되어 있는 것으로 보인다.

3. 포트 번호를 바꿔쓰는 이유
    - 포트 번호를 바꾸지 않고 주소만 바꾸면 프라이비트 주소와 글로벌 주소가 1대1로 대응해서 인터넷에 접속하는 대수만큼 글로벌 주소가 필요함.
    - 포트 번호를 바꿔쓰면 한 개의 글로벌 주소를 수만 개의 프라이비트 주소에 대응시킬 수 있어서 효율이 높아짐.

4. 인터넷에서 회사로 액세스한다
    - 사내에서 인터넷으로 액세스하는 패킷을 중계할 때에는 대응표에 등록되어 있지 않아도 패킷을 중계할 수 있음.
    - 인터넷에서 사내로 패킷을 중계할 때는 대응표에 등록되어 있지 않으면 중계할 수 없음.
        - 인터넷에서 액세스하지 않는 기기에는 인터넷측에서 패킷을 송신할 수 없다는 얘기
        - 액세스 중이라고 해도 통신에 사용하는 포트 번호 이외의 포트에 패킷을 보낼 수 없음.
        - 즉 사내에서 의도적으로 인터넷에 액세스하지 않는 한 인터넷측에서 사내에 패킷을 보낼 수 없다.
        - 부정 침입을 방지하는 효과를 가짐
    - 사내에 액세스하고 싶은 경우에 사전에 수동으로 대응표에 등록해 두면 됨.
        - 사내에 있는 프라이비트 주소를 할당한 서버를 공개할 수도 있다.

5. 라우터의 패킷 필터링 기능
    - 패킷을 중계할 때 MAC 헤더, IP 헤더, TCP 헤더에 기록되어 있는 내용을 조사하여 그것이 사전에 설정한 조건에 합치되면 패킷을 중계하거나 폐기하는 동작이 패킷 필터링 기능임.
        - 대부분 방화벽이라는 기기나 소프트웨어는 이 원리를 이용하여 부정 침입을 방지.
        - 단, 부정 침입과 정상 액세스를 분간하여 부정 침입만 차단하도록 조건을 설정하는 것은 간단하지 않다.